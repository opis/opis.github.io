<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="Learn about ORM relationships">
<title>Relationships | Opis Database</title>
    <link href="/assets/img/favicon.png" rel="shortcut icon">
<link rel="stylesheet" href="/assets/css/flatly-theme.min.css">
<link href="/assets/css/font-awesome.css" rel="stylesheet">
<link href="/assets/css/syntax.css" rel="stylesheet">
<link href="/assets/css/prism-github.css" rel="stylesheet">
<link href="/assets/css/project.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.min.css" />
    <!--[if lt IE 9]>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.ie.min.css" />
    <![endif]-->
    <!--[if lt IE 9]>
<script src="/assets/js/html5shiv.js"></script>
<script src="/assets/js/respond.min.js"></script>
<![endif]-->
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="/assets/js/jquery-1.11.0.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/prism.js"></script>
</head>
<body>
    <div class="github-fork-ribbon-wrapper right hidden-sm hidden-xs">
        <div class="github-fork-ribbon" style="background-color: #f80">
            <a href="https://github.com/opis/database">Fork me on GitHub</a>
        </div>
    </div>
    <header id="header" class="navbar navbar-default navbar-static-top">
        <div class="container">
            <div class="navbar-header">
                <img src="/assets/img/opis-gs-100.png" class="img-responsive opis-inline-logo">
                <a href="/database/3.6" class="navbar-brand">
                    <strong>
                        Database
                    </strong>
                </a>
                <button data-target="#navbar-main" data-toggle="collapse" type="button" class="navbar-toggle">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <nav id="navbar-main" class="collapse navbar-collapse navbar-right">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="/" title="Main page">
                            <span class="fa fa-home"></span> Home
                        </a>
                    </li>
                    <li class="dropdown hidden-md hidden-lg">
    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
        <span class="fa fa-file-text"></span> Documentation <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
            <li class="dropdown-header">Getting started</li>
            <li><a href="/database/3.6/index" title="Getting started with Opis Database">About</a></li>
            <li><a href="/database/3.6/connections" title="Learn how to connect to a database">Database connections</a></li>
            <li class="dropdown-header">The basics</li>
            <li><a href="/database/3.6/fetching-records" title="Fetching records from a database">Fetching records</a></li>
            <li><a href="/database/3.6/results-handling" title="Learn how to handle the result set of a query">Results handling</a></li>
            <li><a href="/database/3.6/aggregate-functions" title="Learn about aggregate functions">Aggregate functions</a></li>
            <li><a href="/database/3.6/extended-selections" title="Learn about how to define custom selections">Extended selections</a></li>
            <li><a href="/database/3.6/filters" title="Learn how to filter records">Filter</a></li>
            <li><a href="/database/3.6/expressions" title="Learn about expressions">Expressions</a></li>
            <li><a href="/database/3.6/ordering-criteria" title="Learn how to order results">Ordering criteria</a></li>
            <li><a href="/database/3.6/limits-and-offsets" title="Learn about limits and offsets">Limits and offset</a></li>
            <li><a href="/database/3.6/joins" title="Learn how to perform joins">Joins</a></li>
            <li><a href="/database/3.6/aggregates-handling" title="Learn how to work with aggregates">Working with aggregates</a></li>
            <li><a href="/database/3.6/insert-records" title="Insert new records into a table">Insert records</a></li>
            <li><a href="/database/3.6/update-records" title="Learn how to update existing records">Update records</a></li>
            <li><a href="/database/3.6/delete-records" title="Learn how to delete existing records">Delete records</a></li>
            <li class="dropdown-header">Transactions</li>
            <li><a href="/database/3.6/transactions" title="Learn how to use transactions">Performing transactions</a></li>
            <li class="dropdown-header">Database schema</li>
            <li><a href="/database/3.6/schema" title="Learn about Opis Database schema">Introduction</a></li>
            <li><a href="/database/3.6/schema-creating-tables" title="Learn how to create new tables">Creating tables</a></li>
            <li><a href="/database/3.6/schema-modifying-tables" title="Learn how to alter existing new tables">Modifying tables</a></li>
            <li class="dropdown-header">ORM</li>
            <li><a href="/database/3.6/orm" title="Learn about Opis Database ORM">Introduction</a></li>
            <li><a href="/database/3.6/orm-basics" title="Learn how to use Opis Database ORM">Basic operations</a></li>
            <li class="active"><a href="/database/3.6/orm-relationships" title="Learn about ORM relationships">Relationships</a></li>
            <li><a href="/database/3.6/orm-models" title="Learn how to work with models">Working with models</a></li>
    </ul>
</li>
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                            <span class="fa fa-cogs"></span> Components <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="/cache/3.1">Cache</a></li>
                            <li><a href="/closure/2.3">Closure</a></li>
                            <li><a href="/config/2.1">Config</a></li>
                            <li><a href="/container/2.3">Container</a></li>
                            <li><a href="/database/3.6">Database</a></li>
                            <li><a href="/events/4.1">Events</a></li>
                            <li><a href="/http/2.0">HTTP</a></li>
                            <li><a href="/http-routing/4.0">HTTP Routing</a></li>
                            <li><a href="/routing/4.1">Routing</a></li>
                            <li><a href="/session/3.1">Session</a></li>
                            <li><a href="/view/4.1">View</a></li>
                        </ul>
                    </li>
                    <li class="hidden-md hidden-lg">
                        <a href="https://github.com/opis/database" title="Github page">
                            <span class="fa fa-github fa-lg"></span> GitHub
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>
    <section>
        <div class="container">
            <div class="row">
                <div class="col-md-4 hidden-xs hidden-sm">
<ul class="navigation">
            <li class="chapter">Getting started</li>
            <ul>
                <li><a href="/database/3.6/index" title="Getting started with Opis Database">About</a></li>
            <li><a href="/database/3.6/connections" title="Learn how to connect to a database">Database connections</a></li>
                </ul>
            <li class="chapter">The basics</li>
            <ul>
                <li><a href="/database/3.6/fetching-records" title="Fetching records from a database">Fetching records</a></li>
            <li><a href="/database/3.6/results-handling" title="Learn how to handle the result set of a query">Results handling</a></li>
            <li><a href="/database/3.6/aggregate-functions" title="Learn about aggregate functions">Aggregate functions</a></li>
            <li><a href="/database/3.6/extended-selections" title="Learn about how to define custom selections">Extended selections</a></li>
            <li><a href="/database/3.6/filters" title="Learn how to filter records">Filter</a></li>
            <li><a href="/database/3.6/expressions" title="Learn about expressions">Expressions</a></li>
            <li><a href="/database/3.6/ordering-criteria" title="Learn how to order results">Ordering criteria</a></li>
            <li><a href="/database/3.6/limits-and-offsets" title="Learn about limits and offsets">Limits and offset</a></li>
            <li><a href="/database/3.6/joins" title="Learn how to perform joins">Joins</a></li>
            <li><a href="/database/3.6/aggregates-handling" title="Learn how to work with aggregates">Working with aggregates</a></li>
            <li><a href="/database/3.6/insert-records" title="Insert new records into a table">Insert records</a></li>
            <li><a href="/database/3.6/update-records" title="Learn how to update existing records">Update records</a></li>
            <li><a href="/database/3.6/delete-records" title="Learn how to delete existing records">Delete records</a></li>
                </ul>
            <li class="chapter">Transactions</li>
            <ul>
                <li><a href="/database/3.6/transactions" title="Learn how to use transactions">Performing transactions</a></li>
                </ul>
            <li class="chapter">Database schema</li>
            <ul>
                <li><a href="/database/3.6/schema" title="Learn about Opis Database schema">Introduction</a></li>
            <li><a href="/database/3.6/schema-creating-tables" title="Learn how to create new tables">Creating tables</a></li>
            <li><a href="/database/3.6/schema-modifying-tables" title="Learn how to alter existing new tables">Modifying tables</a></li>
                </ul>
            <li class="chapter">ORM</li>
            <ul>
                <li><a href="/database/3.6/orm" title="Learn about Opis Database ORM">Introduction</a></li>
            <li><a href="/database/3.6/orm-basics" title="Learn how to use Opis Database ORM">Basic operations</a></li>
            <li class="active"><a href="/database/3.6/orm-relationships" title="Learn about ORM relationships">Relationships</a></li>
            <li><a href="/database/3.6/orm-models" title="Learn how to work with models">Working with models</a></li>
    </ul>
</ul>
                </div>
                <div class="col-md-8 col-sm-12">
                    <h1 id="relationships">Relationships</h1>
<ol>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#one-to-one">One to one</a></li>
  <li><a href="#one-to-many">One to many</a></li>
  <li><a href="#many-to-many">Many to many</a></li>
</ol>
<h2 id="introduction">Introduction</h2>
<p>The relationships between tables can be described by adding methods to your model 
class and utilize the <code>hasOne</code>, <code>hasMany</code>, <code>belongsTo</code> and <code>belongsToMany</code>, inside those methods,
to define the type of the relationship between two models.</p>
<p>The related models can be then retrieved from a model instance by getting the value 
of the property that has the same name as the relationship method.</p><pre><code class="language-php">class User extends BaseModel
{
    // Define a relationship 
    public function articles()
    {
        return $this-&gt;hasMany('Article');
    }
}

// ...

$user = User::find(1);

// Get the related models
foreach($user-&gt;articles as $article)
{
    echo $article-&gt;title, PHP_EOL;
}
</code></pre>
<h2 id="one-to-one">One to one</h2>
<p>A one-to-one relationship is a relation where each record of a table has a single 
related record into another table. For example a <code>User</code> might be associated with a <code>Profile</code>. 
Defining the relationship between <code>User</code> and <code>Profile</code> can be done by placing a 
<code>profile</code> method on the <code>User</code> model. The <code>profile</code> method must return the result of 
calling the <code>hasOne</code> method.</p><pre><code class="language-php">class Profile extends BaseModel
{
    // ...
}

class User extends BaseModel
{
    public function profile()
    {
        return $this-&gt;hasOne('Profile');
    }
}

// ...

$user = User::find(1);

echo $user-&gt;profile-&gt;description;
</code></pre>
<p>The first argument passed to the <code>hasOne</code> method must be the class name of the related model. 
If the model class is under a namespace, then the namespace must be included as well.</p><pre><code class="language-php">return $this-&gt;hasOne('\My\Namespace\Profile');
</code></pre>
<p><strong>Opis Database ORM</strong> assumes that the foreign key of the relationship is based on 
the related model’s name. In this particular case, the <code>Profile</code> model is assumed 
to have a <code>user_id</code> foreign key. If the related model has a differently named foreign key, 
you can specify this by passing the foreign key’s name as a second argument to the <code>hasOne</code> method.</p><pre><code class="language-php">return $this-&gt;hasOne('Profile', 'foreign_key');
</code></pre>
<h4 id="has-one-inverse">The inverse of the relation</h4>
<p>Defining the inverse of a one-to-one relationship is done by using the <code>belongsTo</code> method.</p><pre><code class="language-php">class Profile extends BaseModel
{
    public function user()
    {
        return $this-&gt;belongsTo('User');
    }
}

class User extends BaseModel
{
    public function profile()
    {
        return $this-&gt;hasOne('Profile');
    }
}

// ...

$profile = Profile::find(1);

echo $profile-&gt;user-&gt;name;
</code></pre>
<p>The first argument passed to the <code>belongsTo</code> method must be the class name of the parent model.
If the model class is under a namespace, then the namespace must be included as well.</p><pre><code class="language-php">return $this-&gt;belongsTo('\My\Namespace\User');
</code></pre>
<p>If the model foreign key’s name is different from the name assumed by <strong>Opis Database</strong>
(parent table name + <code>_id</code> suffix), than you can specify the foreign key’s name by passing it
as the second argument to the <code>belongsTo</code> method.</p><pre><code class="language-php">return $this-&gt;belongsTo('User', 'foreign_key');
</code></pre>
<h2 id="one-to-many">One to many</h2>
<p>A one-to-many relationship is a relation where each record of a table might have 
multiple related records into another table. For example, a <code>User</code> might be associated 
with multiple <code>Articles</code>. Defining the relationship between <code>User</code> and <code>Article</code> can be done 
by placing an <code>articles</code> method on the <code>User</code> model. The <code>articles</code> method must return 
the result of calling the <code>hasMany</code> method.</p><pre><code class="language-php">class Article extends BaseModel
{
    // ...
}

class User extends BaseModel
{
    public function articles()
    {
        return $this-&gt;hasMany('Article');
    }
}

// ...

$user = User::find(1);

foreach($user-&gt;articles as $article)
{
    echo $article-&gt;title, PHP_EOL;
}
</code></pre>
<p>The first argument passed to the <code>hasMany</code> method must be the class name of the related model. 
If the model class is under a namespace, then the namespace must be included as well.</p><pre><code class="language-php">return $this-&gt;hasMany('\My\Namespace\Article');
</code></pre>
<p>If the related model’s foreign key doesn’t follow the <strong>Opis Database</strong> naming convention
(parent table name + <code>_id</code> suffix), you may specify the foreign key’s name by passing it 
as the second argument to the <code>hasMany</code> method.</p><pre><code class="language-php">return $this-&gt;hasMany('Article', 'foreign_key');
</code></pre>
<h4 id="has-many-inverse">The inverse of the relation</h4>
<p>As in the case of the one-to-one relationships, the inverse of a one-to-many relationship 
can be defined by using the <code>belongsTo</code> method.</p><pre><code class="language-php">class Article extends BaseModel
{
    public function author()
    {
        return $this-&gt;belongsTo('User');
    }
}

class User extends BaseModel
{
    public function articles()
    {
        return $this-&gt;hasMany('Article');
    }
}

// ...

$article = Article::find(1);

echo $article-&gt;author-&gt;name;
</code></pre>
<h2 id="many-to-many">Many to many</h2>
<p>A many-to-many relationship is a relation where a record from a table might share 
with other records from the same table, multiple related records that are stored into another table.</p>
<p>An example of such a relationship is a user with many roles whom also might be shared by other users. 
In order to define such a relationship, there must be a <a rel="nofollow" target="_blank" href="http://en.wikipedia.org/wiki/Junction_table" title="Junction table">junction table</a> between the two related tables.</p>
<p>Defining a many-to-many relationship is done by using the <code>belongsToMany</code> method. 
The method takes as an argument the full class name(including the namespace) of the related model.</p><pre><code class="language-php">class User extends BaseModel
{
    public function roles()
    {
        return $this-&gt;belongsToMany('Role');
    }
}

class Role extends BaseModel
{
    public function users()
    {
        return $this-&gt;belongsToMany('User');
    }
}

// ...

$user = User::find(1);

foreach($user-&gt;roles as $role)
{
    echo $role-&gt;name, PHP_EOL:
}

$role = Role::find(1);

foreach($role-&gt;users as $user)
{
    echo $user-&gt;name, PHP_EOL;
}
</code></pre>
<h4 id="naming-conventions">Naming conventions</h4>
<p>The junction table name is assumed to be formed from the names of the related tables 
taken in alphabetical order and separated by an underscore. So, if we have two related tables 
named <code>foo</code> and <code>bar</code>, the junction table will be <code>bar_foo</code>. If the name of your junction table 
doesn’t follow this naming convention, then you must pass the name of your junction table as the 
third argument to the <code>belongsToMany</code> method.</p><pre><code class="language-php">return $this-&gt;belongsToMany('Role', null, 'junction_table');
</code></pre>
<p>The junction table must define two columns containing foreign keys to the related tables. 
If we have to related tables <code>foo</code> and <code>bar</code>, the column names must be <code>foo_id</code> and <code>bar_id</code>.</p>
<p>If the foreign key that points from the junction table back to the model doesn’t follow 
the naming convention, you must pass the name of the foreign key as the second argument 
to the <code>belongsToMany</code> method.</p><pre><code class="language-php">return $this-&gt;belongsToMany('Role', 'fk_user');
</code></pre>
<p>If the foreign key that points from the junction table to the related model doesn’t 
follow the naming convention, you must pass the name of the foreign key as the fourth 
argument to the <code>belongsToMany</code> method.</p><pre><code class="language-php">return $this-&gt;belongsToMany('Role', null, null, 'fk_role');
</code></pre>
<ul class="pager">
        <li class="previous"><a href="/database/3.6/orm-basics" title="Basic operations">&larr; Back</a></li>
        <li class="next"><a href="/database/3.6/orm-models" title="Working with models">Next &rarr;</a></li>
</ul>
                </div>
            </div>
        </div>
    </section>
    <a href="#0" id="back-to-top">
    <span class="fa fa-arrow-up"></span>
</a>
<script>
    (function($){
        $(document).ready(function(){
            var visible = false;
            $(window).scroll(function(){
                var top = $(this).scrollTop();
                if (top >= 100 && !visible) {
                    visible = true;
                    $('#back-to-top').fadeIn().show();
                }
                if(top < 100 && visible){
                    visible = false;
                    $('#back-to-top').fadeOut();
                }
            });
            $('#back-to-top').click(function(){
                $('html, body').animate({scrollTop : 0},800);
                return false;
            });
        });
        $('h2[id],h3[id],h4[id],h5[id],h6[id]').each(function () {
            var child = $('<a href="#' + this.getAttribute('id') + '" class="link-anchor"><span class="fa fa-link"></span></a>');
            this.appendChild(child.get(0));
        });
        $('[data-toggle=tooltip]').tooltip();
    })(jQuery);
</script>
    <footer class="text-center text-muted">
        Copyright &copy; 2014-2016 The Opis Project. All rights reserved.
    </footer>
</body>
</html>
