<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="php, database, abstraction, query builder, schema builder">
<meta name="description" content="Learn how to handle the result set">
<title>Results handling | Opis Database</title>
        
        <link href="/assets/img/favicon.png" rel="shortcut icon">
        
        <link rel="stylesheet" href="/assets/css/flatly-theme.min.css">
<link href="/assets/css/font-awesome.css" rel="stylesheet">

<link href="/assets/css/syntax.css" rel="stylesheet">



<link href="/assets/css/style.css" rel="stylesheet">


        <!--[if lt IE 9]>
<script src="/assets/js/html5shiv.js"></script>
<script src="/assets/js/respond.min.js"></script>
<![endif]-->
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="/assets/js/jquery-1.11.0.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/assets/js/bootstrap.min.js"></script>


<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-50415801-1', 'opis.io');
    ga('send', 'pageview');
</script>

    </head>
    <body>
        <header id="header" class="navbar">
    <div class="container">
        <div class="navbar-header">
            <button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
                <span class="sr-only">Toggle navigation</span>
                <i class="fa fa-bars fa-2x"></i>
            </button>
            <h3 class="text-muted">
                <img src="/assets/img/opis-100.png" class="img-responsive opis-inline-logo">
                <strong>Database</strong>
            </h3>
        </div>
        <nav class="collapse navbar-collapse navbar-right" role="navigation">
            <ul class="nav navbar-nav">
                <li>
                    <a href="http://www.opis.io" title="Main page">
                        <span class="fa fa-home"></span> Home
                    </a>
                </li>
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <span class="fa fa-cogs"></span> Components <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="/cache" title="Caching library">Cache</a></li>
                        <li><a href="/closure" title="Serializable closures">Closure</a></li>
                        <li><a href="/config" title="Configuration manager">Config</a></li>
                        <li><a href="/container" title="Dependency injection container">Container</a></li>
                        <li><a href="/database" title="Database abstraction layer">Database</a></li>
                        <li><a href="/events" title="Events library">Events</a></li>
                        <li><a href="https://github.com/opis/http" title="HTTP library">HTTP</a></li>
                        <li><a href="/http-routing" title="HTTP routing library">HTTP Routing</a></li>
                        <li><a href="/routing" title="Routing framework">Routing</a></li>
                        <li><a href="/session" title="Session manager">Session</a></li>
                        <li><a href="/utils" title="Utilitary classes">Utils</a></li>
                        <li><a href="/view" title="Rendering engine">View</a></li>
                    </ul>
                </li>
                <li>
                    <a href="https://github.com/opis/database" title="Github page">
                        <span class="fa fa-github fa-lg"></span> GitHub
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</header>
<div class="container">
    <div class="row">
        <div class="col-md-4">
            <div class="list-group">
            
                
                    
<a href="/database" class="list-group-item">

    <h4 class="list-group-item-heading">About</h4>
    <p class="list-group-item-text text-muted">
        Getting started with Opis Database
    </p>
</a>
                
            
                
                    
<a href="/database/connection.html" class="list-group-item">

    <h4 class="list-group-item-heading">Connections</h4>
    <p class="list-group-item-text text-muted">
        Learn how to connect to a database
    </p>
</a>
                
            
                
                    
<a href="/database/select.html" class="list-group-item">

    <h4 class="list-group-item-heading">Fetching records</h4>
    <p class="list-group-item-text text-muted">
        Fetching records from a database
    </p>
</a>
                
            
                
                    
<a href="/database/result.html" class="list-group-item active">

    <h4 class="list-group-item-heading">Results handling</h4>
    <p class="list-group-item-text text-muted">
        Learn how to handle the result set of a query
    </p>
</a>
                
            
                
                    
<a href="/database/aggregate.html" class="list-group-item">

    <h4 class="list-group-item-heading">Aggregate functions</h4>
    <p class="list-group-item-text text-muted">
        Learn about aggregate functions
    </p>
</a>
                
            
                
                    
<a href="/database/defining-columns.html" class="list-group-item">

    <h4 class="list-group-item-heading">Defining fetched columns</h4>
    <p class="list-group-item-text text-muted">
        Learn about how to define selected columns
    </p>
</a>
                
            
                
                    
<a href="/database/filter.html" class="list-group-item">

    <h4 class="list-group-item-heading">Filters</h4>
    <p class="list-group-item-text text-muted">
        Learn how to filter records
    </p>
</a>
                
            
                
                    
<a href="/database/order.html" class="list-group-item">

    <h4 class="list-group-item-heading">Ordering criteria</h4>
    <p class="list-group-item-text text-muted">
        Learn how to order results
    </p>
</a>
                
            
                
                    
<a href="/database/limit.html" class="list-group-item">

    <h4 class="list-group-item-heading">Limits and offsets</h4>
    <p class="list-group-item-text text-muted">
        Learn about limits and offsets
    </p>
</a>
                
            
                
                    
<a href="/database/expression.html" class="list-group-item">

    <h4 class="list-group-item-heading">Expressions</h4>
    <p class="list-group-item-text text-muted">
        Learn about expressions
    </p>
</a>
                
            
                
                    
<a href="/database/group.html" class="list-group-item">

    <h4 class="list-group-item-heading">Group</h4>
    <p class="list-group-item-text text-muted">
        Learn how to group results
    </p>
</a>
                
            
                
                    
<a href="/database/join.html" class="list-group-item">

    <h4 class="list-group-item-heading">Joins</h4>
    <p class="list-group-item-text text-muted">
        Learn how to perform joins
    </p>
</a>
                
            
                
                    
<a href="/database/insert.html" class="list-group-item">

    <h4 class="list-group-item-heading">Create records</h4>
    <p class="list-group-item-text text-muted">
        Insert new records into a table
    </p>
</a>
                
            
                
                    
<a href="/database/update.html" class="list-group-item">

    <h4 class="list-group-item-heading">Update records</h4>
    <p class="list-group-item-text text-muted">
        Learn how to update existing records
    </p>
</a>
                
            
                
                    
<a href="/database/delete.html" class="list-group-item">

    <h4 class="list-group-item-heading">Delete records</h4>
    <p class="list-group-item-text text-muted">
        Learn how to delete existing records
    </p>
</a>
                
            
                
                    
<a href="/database/transaction.html" class="list-group-item">

    <h4 class="list-group-item-heading">Transactions</h4>
    <p class="list-group-item-text text-muted">
        Learn how to use transactions
    </p>
</a>
                
            
                
                    
<a href="/database/schema.html" class="list-group-item">

    <h4 class="list-group-item-heading">Schema</h4>
    <p class="list-group-item-text text-muted">
        Create new tables and obtains information about existing ones
    </p>
</a>
                
            
            </div>
        </div>
        <div class="col-md-8">
            <h1><strong>Results handling</strong></h1>

<ol class="submenu">
    <li>




    

<a href="#introduction">Introduction</a></li>
    <li>




    

<a href="#using-the-cursor">Using the cursor</a></li>
    <li>




    

<a href="#fetching-options">Fetching options</a></li>
    <li>




    

<a href="#callback-functions">Callback functions</a></li>
</ol>


        


    

<h3>
    
    <strong>Introduction</strong>
    <a id="introduction" href="#introduction" class="link-anchor"><span class="fa fa-link"></span></a>
</h3>

<p>
    As you have already learned, <a href="/database/select.html">fetching records</a> is done by using the <code>select</code> method.
    In order to improve performance and to provide developers a greater control over the result set
    returned by a query, instead of simply returning a list with results, the <code>select</code> method
    returns a cursor to a result set, represented by an instance of the <code>Opis\Database\ResultSet</code> class.
    This class contains various methods used in data handling, including the <code>all</code> method that was presented in the previous section.
</p>


        


    

<h3>
    
    <strong>Using the cursor</strong>
    <a id="using-the-cursor" href="#using-the-cursor" class="link-anchor"><span class="fa fa-link"></span></a>
</h3>

<p>
    Using the <code>all</code> method is perfectly fine when we are dealing with reasonable data sets, but
    we can quickly run out of memory if we are dealing with large data sets. This is because the <code>all</code>
    method transfers all the results from the database into PHP's memory and stores them into an array.
    One solution to avoid going out of memory when dealing with large data sets is to iterate through the
    entire result set and process one result at a time.
</p>

<div class="highlight"><pre><code class="php"><span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">));</span>
             
<span class="k">while</span><span class="p">(</span><span class="k">false</span> <span class="o">!==</span> <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">())</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>


        


    

<h3>
    
    <strong>Fetching options</strong>
    <a id="fetching-options" href="#fetching-options" class="link-anchor"><span class="fa fa-link"></span></a>
</h3>

<p>
    By default the results of a query are fetched as anonymous objects with property names
    that correspond to the column names returned in your result set.
    You can change this behavior by using a set of methods provided by the <code>Opid\Database\ResultSet</code>
    class.
</p>

<p>
    Fetching records as an array indexed by column name is done using the <code>fetchAssoc</code> method.
</p>

<div class="highlight"><pre><code class="php"><span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">))</span>
             <span class="o">-&gt;</span><span class="na">fetchAssoc</span><span class="p">()</span>
             <span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>
             
<span class="k">foreach</span><span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>

<p>
    Fetching records as an array indexed by column number, starting at column 0, is done using the
    <code>fetchNum</code> method.
</p>

<div class="highlight"><pre><code class="php"><span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">))</span>
             <span class="o">-&gt;</span><span class="na">fetchNum</span><span class="p">()</span>
             <span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>
             
<span class="k">foreach</span><span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$user</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$user</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>

<p>
    The <code>fetchBoth</code> method fetch each record as an array indexed by both column name and column number.
</p>

<div class="highlight"><pre><code class="php"><span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">))</span>
             <span class="o">-&gt;</span><span class="na">fetchBoth</span><span class="p">()</span>
             <span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>
             
<span class="k">foreach</span><span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//prints name and email</span>
    <span class="k">echo</span> <span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nv">$user</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p>
    The <code>fetchNamed</code> method is similar to <code>fetchAssoc</code> method, except that if there are
    multiple columns with the same name, the value referred to by that key will be an array of all the values
    in the row that had that column name.
</p>
<p>
    You can map the columns of the result set to named properties in a custom class by using the <code>fetchClass</code> method.
    The method accepts as arguments a class name and optionally an array of arguments that will be
    passed to the class constructor.
</p>
<p class="well text-danger">
    <strong><span class="fa fa-exclamation-triangle"></span> Important!</strong>
    The named properties of your class that will be mapped to column names must have <code>public</code> access.
</p>

<div class="highlight"><pre><code class="php"><span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$email</span><span class="p">;</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">test</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">))</span>
             <span class="o">-&gt;</span><span class="na">fetchClass</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>
             
<span class="k">foreach</span><span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">test</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>


        


    

<h3>
    
    <strong>Callback functions</strong>
    <a id="callback-functions" href="#callback-functions" class="link-anchor"><span class="fa fa-link"></span></a>
</h3>

<p>
    <strong>Opis Database</strong> allows you to specify a callback function that can be
    passed as an argument to the <code>all</code> and the <code>first</code> methods.
    Records are mapped to the result of calling the callback function using each row's
    columns as parameters in the call.
</p>

<div class="highlight"><pre><code class="php"><span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$email</span><span class="p">;</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$email</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">email</span> <span class="o">=</span> <span class="nv">$email</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getEmail</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendEmail</span><span class="p">(</span><span class="nv">$subject</span><span class="p">,</span> <span class="nv">$message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">mail</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">,</span> <span class="nv">$subject</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
    <span class="p">}</span>
    
<span class="p">}</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">))</span>
             <span class="o">-&gt;</span><span class="na">all</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$email</span><span class="p">){</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$email</span><span class="p">);</span>
             <span class="p">});</span>

<span class="nv">$message</span> <span class="o">=</span> <span class="s2">&quot;Opis Database is great! http://www.opis.io/database&quot;</span><span class="p">;</span>
             
<span class="k">foreach</span><span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$subject</span> <span class="o">=</span> <span class="s2">&quot;Hello &quot;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span>
    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">sendEmail</span><span class="p">(</span><span class="nv">$subject</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p class="well text-primary">
    <strong><span class="fa fa-pencil"></span> TODO:</strong>
    Provide more detailed examples about how to handle the result set of a query.
</p>

            





    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
        
    

    
        
            
                
                
            
        
    

    

    

    

    

    

    

    

    

    

    

    

    


<ul class="pager">
  
  <li class="previous"><a href="/database/select.html" title="Fetching records">&larr; Back</a></li>
  
  
  <li class="next"><a href="/database/aggregate.html" title="Aggregate functions">Next &rarr;</a></li>
  
</ul>
            
        </div>
    </div>
</div>
<div id="footer" class="text-center text-muted">
    Copyright &copy; 2014 Marius Sarca. All rights reserved.
</div>

    </body>
</html>
